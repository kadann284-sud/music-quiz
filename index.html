<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>music-match：共通アーティスト対戦</title>
  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <header class="app-header">
    <h1>music-match：共通アーティスト対戦</h1>
    <p class="sub">
      1台端末 / 同じ問題をみんなが順番に解く / 4択〜<br>
      人数：2〜6人 / イントロは「再生→全員回答」
    </p>
  </header>

  <main class="container">

    <!-- ===== Setup ===== -->
    <section id="setup" class="card">
      <h2>1) アーティスト登録</h2>

      <div class="row">
        <div class="small">
          <label>人数（2〜6）</label>
          <input id="playerCount" class="input smallInput" type="number" min="2" max="6" value="2" />
        </div>

        <div class="small">
          <label>ラウンド数</label>
          <input id="totalQ" class="input smallInput" type="number" min="3" value="12" />
        </div>

        <div class="small">
          <label>出題モード</label>
          <select id="quizMode" class="input smallInput">
            <option value="intro_only" selected>イントロのみ</option>
            <option value="mix">イントロ＋他（ジャケ写 / data.json）</option>
          </select>
        </div>

        <div class="small">
          <label>選択肢数</label>
          <select id="choiceCount" class="input smallInput">
            <option value="auto" selected>自動（easy=4 / normal=6 / hard=8）</option>
            <option value="4">4択固定</option>
            <option value="6">6択固定</option>
            <option value="8">8択固定</option>
            <option value="10">10択固定</option>
          </select>
        </div>

        <div class="small">
          <label>イントロ秒数</label>
          <select id="introLen" class="input smallInput">
            <option value="8">8秒</option>
            <option value="5" selected>5秒</option>
            <option value="3">3秒</option>
          </select>
        </div>

        <div class="small">
          <label>制限時間（0で無効）</label>
          <input id="timeLimit" class="input smallInput" type="number" min="0" value="10" />
        </div>
      </div>

      <h3 class="h3">プレイヤー名</h3>
      <div id="playerInputs" class="row"></div>

      <div class="hint">
        <p class="sub">
          ランク値：A=1, B=2, C=3, D=4（小さいほど“聴いてる”）<br>
          正解した人だけ加点：最高ランクの人は +1 / それ以外は +1 + (自分−最高)÷3<br>
          出題難易度：全員A/B → hard寄り、全員C/D → easy寄り（data.jsonも同様）<br>
          ★easy/hardの曲選びは「擬似サブスク再生数(popScore)」で寄せています
        </p>
      </div>

      <div class="btnGrid">
        <button id="btnRerollCandidates" class="btn primary">候補10個ランダム</button>
        <button id="btnClearRanksThis10" class="btn">この10個だけリセット</button>
        <button id="btnClearP2Only" class="btn">2人目だけ履歴削除（互換）</button>
        <button id="btnClearAllSaved" class="btn danger">全消去</button>
      </div>

      <h3 class="h3">今回の候補（10個）</h3>
      <div id="candidateCards" class="cards cards-candidate"></div>

      <h3 class="h3">登録済み（蓄積）</h3>
      <div class="sub" id="savedSummary"></div>
      <details class="accordion" open>
        <summary>登録済み一覧を開く/閉じる</summary>
        <div id="savedCards" class="cards cards-saved"></div>
      </details>

      <div class="row">
        <button id="btnBuildCommon" class="btn primary wide">共通アーティストを抽出 → 開始準備</button>
      </div>

      <div class="sub" id="dataStatus"></div>
      <div id="setupMsg" class="msg"></div>
    </section>

    <!-- ===== Common ===== -->
    <section id="common" class="card hidden">
      <h2>2) 共通アーティスト</h2>
      <p class="sub">共通が1件以上あれば開始OK</p>

      <div id="commonList" class="list"></div>

      <div class="btnGrid">
        <button id="btnFetchData" class="btn primary">iTunes取得して開始</button>
        <button id="btnBackToSetup" class="btn">戻る</button>
      </div>

      <div id="commonMsg" class="msg"></div>
    </section>

    <!-- ===== Game ===== -->
    <section id="game" class="card hidden">
      <h2 class="gameTitle">3) 対戦</h2>

      <div id="scoreHUD" class="topHUD"></div>

      <div class="turn">
        <div class="badge" id="turnBadge">Round 1</div>
        <div class="tiny" id="qMeta"></div>
      </div>

      <div class="timerRow">
        <div class="timerLeft">
          <div class="timerLabel">⏱ <span id="timeLeft">--</span>s</div>
          <div class="timeBar">
            <div id="timeBarFill" class="timeBarFill"></div>
          </div>
        </div>
        <div class="tiny" id="timerNote"></div>
      </div>

      <div id="handoff" class="handoff">
        <div class="handoffBox">
          <h3 id="handoffTitle">次の人へ</h3>
          <p class="sub">画面を隠してから押してね</p>
          <button id="btnReveal" class="btn primary wide">問題を見る</button>
        </div>
      </div>

      <div id="qBox" class="qBox hidden">
        <div id="qText" class="qText"></div>
        <div id="qMedia" class="qMedia hidden"></div>

        <div id="choices" class="choices"></div>

        <div class="phaseBox">
          <div class="phaseLine" id="phaseLine">P1が回答</div>
          <div class="sub tiny" id="rankLine"></div>
        </div>

        <div id="result" class="result"></div>
      </div>
    </section>

    <!-- ===== Done ===== -->
    <section id="done" class="card hidden">
      <h2>結果</h2>
      <div id="final" class="final"></div>
      <div class="row">
        <button id="btnRestart" class="btn primary wide">最初から</button>
      </div>
    </section>

  </main>

  <!-- 固定アクションバー -->
  <div id="actionBar" class="actionBar hidden">
    <button id="btnNext" class="btn primary flex1" disabled>次へ</button>
    <button id="btnEnd" class="btn ghost">終了</button>
  </div>

  <footer class="footer">
    <small>Data: iTunes API + local data.json + manual_tracks.json</small>
  </footer>

  <script src="./main.js"></script>
</body>
</html>
